<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Astral Plane</title>
  <style>
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<!-- ‚≠ê Existing Sections ‚≠ê -->
<div id="home">
  <h1 id="welcomeText">Loading...</h1>
  <button onclick="showPage('dice')">Dice Roller</button>
  <button onclick="showPage('map')">Map Drawer</button>
  <button onclick="showPage('riddleSection')">Riddle Challenge</button>
  <button onclick="goHome()">Home</button>
</div>

<div id="dice" class="hidden">
  <h2>Dice Roller</h2>
  <button onclick="rollDice(6)" class="dice">Roll D6</button>
  <button onclick="rollDice(20)" class="dice">Roll D20</button>
  <div id="result"></div>
  <button onclick="goHome()">Back</button>
</div>

<div id="map" class="hidden">
  <h2>Map Drawer</h2>
  <canvas id="mapCanvas" width="800" height="600" style="border:1px solid black;"></canvas>
  <br>
  <button onclick="toggleTool()">Toggle Eraser/Draw</button>
  <button onclick="clearCanvas()">Clear Map</button>
  <button onclick="goHome()">Back</button>
</div>

<!-- ‚≠ê New Riddle Section ‚≠ê -->
<div id="riddleSection" class="hidden">
  <h2>Riddle of the Day</h2>
  <p id="riddleQuestion"></p>
  <input type="text" id="riddleAnswer" placeholder="Type your answer...">
  <button onclick="checkRiddleAnswer()">Submit Answer</button>
  <p id="riddleResult"></p>
  <button onclick="goHome()">Back</button>
</div>

<!-- ‚≠ê Script Area ‚≠ê -->
<script>
  // Welcome Message
  let userName = localStorage.getItem('userName');
  const welcomeText = document.getElementById('welcomeText');

  if (!userName) {
    userName = prompt("Greetings traveler, what is your name?");
    if (userName) {
      localStorage.setItem('userName', userName);
    }
  }

  if (userName) {
    const lowerName = userName.trim().toLowerCase();
    if (lowerName === 'eddie') {
      welcomeText.textContent = "Welcome Dungeon Master.";
    } else if (lowerName === 'calico') {
      welcomeText.textContent = "Welcome Captain.";
    } else {
      welcomeText.textContent = `Welcome, ${userName.trim()}, to the astral plane...`;
    }
  } else {
    welcomeText.textContent = "Welcome, traveler, to the astral plane...";
  }

  // Navigation
  function showPage(pageId) {
    document.getElementById('home').classList.add('hidden');
    document.getElementById('dice').classList.add('hidden');
    document.getElementById('map').classList.add('hidden');
    document.getElementById('riddleSection').classList.add('hidden');

    document.getElementById(pageId).classList.remove('hidden');

    if (pageId === 'riddleSection') {
      showRiddle();
    }
  }

  function goHome() {
    document.getElementById('home').classList.remove('hidden');
    document.getElementById('dice').classList.add('hidden');
    document.getElementById('map').classList.add('hidden');
    document.getElementById('riddleSection').classList.add('hidden');
  }

  // Dice Roller
  function rollDice(sides) {
    const diceElements = document.querySelectorAll('.dice');
    diceElements.forEach(dice => dice.classList.remove('rolling'));
    const resultDiv = document.getElementById('result');
    resultDiv.textContent = "Rolling...";
    const clickedDice = event.target;
    clickedDice.classList.add('rolling');
    setTimeout(() => {
      const roll = Math.floor(Math.random() * sides) + 1;
      resultDiv.textContent = `üé≤ You rolled a ${roll} on a D${sides}!`;
      clickedDice.classList.remove('rolling');
    }, 800);
  }

  // Map Drawing
  let drawing = false;
  let erasing = false;
  const mapCanvas = document.getElementById('mapCanvas');
  const mapCtx = mapCanvas.getContext('2d');
  mapCanvas.addEventListener('mousedown', startDrawing);
  mapCanvas.addEventListener('mouseup', stopDrawing);
  mapCanvas.addEventListener('mouseout', stopDrawing);
  mapCanvas.addEventListener('mousemove', drawOnMap);

  function startDrawing(e) {
    drawing = true;
    const rect = mapCanvas.getBoundingClientRect();
    mapCtx.beginPath();
    mapCtx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
  }

  function stopDrawing() {
    drawing = false;
  }

  function drawOnMap(e) {
    if (!drawing) return;
    const rect = mapCanvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    mapCtx.lineWidth = erasing ? 20 : 3;
    mapCtx.lineCap = 'round';
    mapCtx.strokeStyle = erasing ? '#ffffff' : '#000000';
    mapCtx.lineTo(x, y);
    mapCtx.stroke();
  }

  function toggleTool() {
    erasing = !erasing;
    alert(erasing ? "Eraser On" : "Draw Mode On");
  }

  function clearCanvas() {
    mapCtx.fillStyle = "#ffffff";
    mapCtx.fillRect(0, 0, mapCanvas.width, mapCanvas.height);
  }

  // Riddle System
  const riddles = [
    { question: "I speak without a mouth and hear without ears. I have no body, but I come alive with wind. What am I?", answer: "echo" },
    { question: "The more of me you take, the more you leave behind. What am I?", answer: "footsteps" },
    { question: "What has keys but can't open locks?", answer: "piano" },
    { question: "I‚Äôm tall when I‚Äôm young, and I‚Äôm short when I‚Äôm old. What am I?", answer: "candle" }
  ];
  let currentRiddle;

  function showRiddle() {
    currentRiddle = riddles[Math.floor(Math.random() * riddles.length)];
    document.getElementById('riddleQuestion').textContent = currentRiddle.question;
    document.getElementById('riddleResult').textContent = '';
  }

  function checkRiddleAnswer() {
    const userAnswer = document.getElementById('riddleAnswer').value.trim().toLowerCase();
    if (userAnswer === currentRiddle.answer) {
      document.getElementById('riddleResult').textContent = "‚úÖ Correct! Welcome, wise one.";
    } else {
      document.getElementById('riddleResult').textContent = "‚ùå Incorrect. Try again!";
    }
  }
</script>

</body>
</html>
